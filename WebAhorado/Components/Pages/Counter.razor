@page "/counter"
@using TPAhorcado
@rendermode InteractiveServer

<PageTitle>🎯 Juego del Ahorcado</PageTitle>

<h1 id="tituloJuego">Juego del Ahorcado</h1>

@if (game.GameOver())
{
    <div id="gameOverBanner">
        <h4 class="text-danger">¡Game Over! 😢</h4>
        <button id="btnReiniciar" class="btn btn-primary" @onclick="Reiniciar">Reiniciar</button>
    </div>
}
else
{
    <div class="mt-3">
        <p id="estadoJuego"><strong>Palabra:</strong> @game.MostrarPalabra()</p>
        <p id="contadorIntentos"><strong>Intentos de letra:</strong> @game.intentosLetraEnJuego / 6</p>
        <p><strong>Intentos de palabra:</strong> @game.intentosPalabraEnJuego / 3</p>

        <input id="inputLetra" @bind="entrada" placeholder="Ingrese letra o palabra" class="form-control" style="width:200px" />
        <button id="btnProbarLetra" type="button" class="btn btn-success mt-2" @onclick="Jugar">Probar</button>

        <p id="mensajeJuego" class="mt-3 text-info">@mensaje</p>
    </div>
}

@code {
    private JuegoAhorcado game = new();
    private string entrada = "";
    private string mensaje = "";

    private void Jugar()
    {
        Console.WriteLine($"Entrada: {entrada}");

        if (string.IsNullOrWhiteSpace(entrada))
            return;

        if (entrada.Length == 1)
        {
            bool acierto = game.TirarLetraYAcertar(entrada.ToLower());
            mensaje = acierto ? "✅ ¡Letra correcta!" : "❌ Letra incorrecta.";
        }
        else
        {
            bool acierto = game.TirarPalabraYAcertar(entrada.ToLower());
            mensaje = acierto ? "🎉 ¡Adivinaste la palabra!" : "😕 Palabra incorrecta.";
        }

        if (game.palabraEnJuego == game.palabraSecreta)
        {
            mensaje = "🎉 ¡Ganaste! Adivinaste la palabra completa!";
        }

        entrada = "";
        StateHasChanged();
    }

    private void Reiniciar()
    {
        game.Reiniciar();
        mensaje = "";
        StateHasChanged(); 
    }
}
